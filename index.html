<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>수강료 계산기</title>
  <!-- jQuery 및 jQuery UI CDN -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  <!-- Select2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background: #f9f9f9;
    }
    h2 {
      color: #333;
      margin-bottom: 20px;
    }
    form {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      max-width: 600px;
    }
    .form-group {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    label {
      width: 160px;
      margin-right: 10px;
      font-weight: bold;
    }
    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group select:not(.select2-hidden-accessible) {
      flex: none;
      width: 250px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px 20px;
      border: none;
      background-color: #337ab7;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #286090;
    }
    #reservationInfo {
      background: #fff;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #reservationInfo p {
      margin: 8px 0;
    }
    /* Select2 드롭다운 스타일 */
    .select2-container {
      width: 400px !important;
    }
    .select2-container--default .select2-results__options {
      max-height: 500px !important;
      overflow-y: auto;
    }
    /* AP 시간 선택 컨테이너 스타일 (폼 그룹과 유사하게) */
    #apTimeContainer {
      margin-bottom: 15px;
      padding-left: 170px;
    }
    /* 토스트 메시지 스타일 */
    #toast {
      visibility: hidden;
      min-width: 200px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 4px;
      padding: 10px;
      position: fixed;
      top: 30px;
      left: 20px;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
  </style>
  <script>
    function showToast(message) {
      var toast = document.getElementById("toast");
      toast.textContent = message;
      toast.style.visibility = "visible";
      toast.style.opacity = "1";
      setTimeout(function() {
        toast.style.opacity = "0";
        setTimeout(function() { toast.style.visibility = "hidden"; }, 500);
      }, 2500);
    }
    
    (function(factory) {
      if (typeof define === "function" && define.amd) {
        define(["jquery", "jquery-ui"], factory);
      } else {
        factory(jQuery);
      }
    }(function($) {
      $.datepicker.regional['ko'] = {
        closeText: '닫기',
        prevText: '이전',
        nextText: '다음',
        currentText: '오늘',
        monthNames: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
        monthNamesShort: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
        dayNames: ['일요일','월요일','화요일','수요일','목요일','금요일','토요일'],
        dayNamesShort: ['일','월','화','수','목','금','토'],
        dayNamesMin: ['일','월','화','수','목','금','토'],
        weekHeader: '주',
        dateFormat: 'yy-mm-dd',
        firstDay: 0,
        isRTL: false,
        showMonthAfterYear: true,
        yearSuffix: '년'
      };
      $.datepicker.setDefaults($.datepicker.regional['ko']);
    }));
    
    // AP 시간 옵션 설정
    var apTimeOptions = {
      group1: {
        courses: ["여름방학 AP Phy1", "여름방학 AP Cal BC", "여름방학 AP Cal AB", "여름방학 AP Pre-cal", "여름방학 AP World History", "여름방학 AP Biology"],
        options: [
          { label: "오전 (09:00~11:00)", time: "09:00~11:00" },
          { label: "오후 (18:20~20:20)", time: "18:20~20:20" }
        ]
      },
      group2: {
        courses: ["여름방학 AP Phy C-M", "여름방학 AP Macro Econ", "여름방학 AP Micro Econ", "여름방학 AP Psychology", "여름방학 AP Statistics", "여름방학 AP Chemistry", "여름방학 AP Computer.A"],
        options: [
          { label: "오전 (11:10~13:10)", time: "11:10~13:10" },
          { label: "오후 (20:30~22:30)", time: "20:30~22:30" }
        ]
      }
    };
    
    // 과목 정보
    var courseData = {
      "여름방학 Algebra 1 오프라인": { category: "Drill Math", weeklyRate: 250000, time: "14:00~16:00" },
      "여름방학 Algebra 1 온라인": { category: "Drill Math", weeklyRate: 250000, time: "16:10~18:10(한국시간)" },
      "여름방학 Algebra 2 오프라인": { category: "Drill Math", weeklyRate: 250000, time: "14:00~16:00" },
      "여름방학 Algebra 2 온라인": { category: "Drill Math", weeklyRate: 250000, time: "16:10~18:10(한국시간)" },
      // DRW 카테고리 (추가된 항목 포함)
      "여름방학 DRW 오전 L1": { category: "DRW", weeklyRate: 330000, time: "10:00~13:00(한국시간)" },
      "여름방학 DRW 오전 L2": { category: "DRW", weeklyRate: 330000, time: "10:00~13:00(한국시간)" },
      "여름방학 DRW L1A": { category: "DRW", weeklyRate: 330000, time: "19:00~22:00(한국시간)" },
      "여름방학 DRW L1B": { category: "DRW", weeklyRate: 330000, time: "20:00~23:00(한국시간)" },
      "여름방학 DRW L2A": { category: "DRW", weeklyRate: 330000, time: "19:00~22:00(한국시간)" },
      "여름방학 DRW L2B": { category: "DRW", weeklyRate: 330000, time: "20:00~23:00(한국시간)" },
      "여름방학 DRW L3":  { category: "DRW", weeklyRate: 330000, time: "20:00~23:00(한국시간)" },
      "여름방학 W올인원": { category: "W올인원", weeklyRate: 440000, time: "09:00~13:00" },
      "여름방학 TOEFL L1 오프라인": { category: "TOEFL", weeklyRate: 520000, time: "09:00~13:00" },
      "여름방학 TOEFL L1 오전 온라인": { category: "TOEFL", weeklyRate: 520000, time: "09:00~13:00(한국시간)" },
      "여름방학 TOEFL L1 오후 온라인": { category: "TOEFL", weeklyRate: 520000, time: "13:30~17:30(한국시간)" },
      "여름방학 TOEFL L2 오프라인": { category: "TOEFL", weeklyRate: 520000, time: "09:00~13:00" },
      "여름방학 TOEFL L2 오전 온라인": { category: "TOEFL", weeklyRate: 520000, time: "09:00~13:00(한국시간)" },
      "여름방학 TOEFL L2 오후 온라인": { category: "TOEFL", weeklyRate: 520000, time: "13:30~17:30(한국시간)" },
      "여름방학 SAT 브릿지 오프라인": { category: "SAT", weeklyRate: 950000, time: "09:00~17:00" },
      "여름방학 SAT 브릿지 온라인": { category: "SAT", weeklyRate: 950000, time: "13:00~21:00(한국시간)" },
      "여름방학 SAT 1400+ 오프라인": { category: "SAT", weeklyRate: 950000, time: "09:00~17:00" },
      "여름방학 SAT 1400+ 온라인": { category: "SAT", weeklyRate: 950000, time: "13:00~21:00(한국시간)" },
      "여름방학 SAT 1500+ 오프라인": { category: "SAT", weeklyRate: 950000, time: "09:00~17:00" },
      "여름방학 SAT 1500+ 온라인": { category: "SAT", weeklyRate: 950000, time: "13:00~21:00(한국시간)" },
      "여름방학 SAT 미주반": { category: "SAT미주/유럽", weeklyRate: 560000, time: "10:00~14:00(한국시간)" },
      "여름방학 SAT 유럽반": { category: "SAT미주/유럽", weeklyRate: 560000, time: "17:00~21:00(한국시간)" },
      "여름방학 AP Phy1":         { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Cal BC":        { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Cal AB":        { category: "AP", threeWeekRate: 1380000, time: "시간 미정" },
      "여름방학 AP Pre-cal":       { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP World History": { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Biology":       { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Phy C-M":       { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Macro Econ":    { category: "AP", threeWeekRate: 1035000, time: "시간 미정" },
      "여름방학 AP Micro Econ":    { category: "AP", threeWeekRate: 1035000, time: "시간 미정" },
      "여름방학 AP Psychology":    { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Statistics":    { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Chemistry":     { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Computer.A":    { category: "AP", threeWeekRate: 1725000, time: "시간 미정" }
    };
    
    function isDateAllowed(date) {
      if (date.getFullYear() === 2025 && date.getMonth() === 5 &&
          date.getDate() >= 1 && date.getDate() <= 15) {
        return false;
      }
      var course = $("#course").val();
      var courseInfo = courseData[course];
      var courseCategory = courseInfo ? courseInfo.category : "";
      if (courseCategory === "AP") {
        if (date.getFullYear() === 2025 && date.getMonth() === 6 &&
            (date.getDate() === 7 || date.getDate() === 8)) {
          return false;
        }
      }
      if ((courseCategory === "DRW" || courseCategory === "Drill Math" ||
           courseCategory === "W올인원") &&
          date.getFullYear() === 2025 && date.getMonth() === 5 &&
          date.getDate() === 16) {
        return false;
      }
      var allowedDay = (course === "여름방학 AP Micro Econ") ? 2 : 1;
      return date.getDay() === allowedDay;
    }
    
    $(function() {
      $("#course").select2({
        placeholder: "수강과목을 선택하세요",
        allowClear: true
      });
      
      $("#startDate").datepicker({
        dateFormat: "yy-mm-dd",
        minDate: new Date(2025, 5, 16),
        maxDate: new Date(2025, 7, 31),
        beforeShowDay: function(date) {
          if (date.getFullYear() === 2025 && date.getMonth() === 5 &&
              date.getDate() >= 1 && date.getDate() <= 15) {
            return [false, "", "Unavailable"];
          }
          var allowed = isDateAllowed(date);
          return [allowed, "", allowed ? "Available" : "Not allowed"];
        }
      });
      
      $("#course").on("change", function() {
        var selectedDateStr = $("#startDate").val();
        if (selectedDateStr) {
          try {
            var selectedDate = $.datepicker.parseDate("yy-mm-dd", selectedDateStr);
            if (!isDateAllowed(selectedDate)) {
              $("#startDate").val("");
            }
          } catch(e) {
            $("#startDate").val("");
          }
        }
        $("#startDate").datepicker("refresh");
        updateAPTimeOptions();
      });
      
      $(document).keydown(function(e) {
        if(e.altKey && e.which === 81) {
          e.preventDefault();
          calculateTuition();
        } else if(e.altKey && e.which === 82) {
          e.preventDefault();
          copyReservationInfo();
        }
      });
    });
    
    function formatDateWithDay(date) {
      var month = date.getMonth() + 1;
      var day = date.getDate();
      var days = ["일", "월", "화", "수", "목", "금", "토"];
      return month + ". " + day + "(" + days[date.getDay()] + ")";
    }
    
    function updateAPTimeOptions() {
      var course = $("#course").val();
      var container = $("#apTimeContainer");
      container.empty();
      // AP 과목이 아니면 컨테이너 숨김
      if (!courseData[course] || courseData[course].category !== "AP") {
        container.hide();
        return;
      }
      var group = null;
      if (apTimeOptions.group1.courses.indexOf(course) !== -1) {
        group = apTimeOptions.group1;
      } else if (apTimeOptions.group2.courses.indexOf(course) !== -1) {
        group = apTimeOptions.group2;
      }
      if (group) {
        container.show();
        container.append("<p>AP 시간 선택:</p>");
        for (var i = 0; i < group.options.length; i++) {
          var opt = group.options[i];
          var radioId = "apTimeOption" + i;
          var radio = '<label for="' + radioId + '" style="margin-right:15px;"><input type="radio" name="apTimeOption" id="' + radioId + '" value="' + opt.time + '"';
          if (i === 0) radio += ' checked';
          radio += '> ' + opt.label + '</label>';
          container.append(radio);
        }
      } else {
        container.hide();
      }
    }
    
    function calculateTuition() {
      var name = document.getElementById("studentName").value;
      var course = document.getElementById("course").value;
      var startDateStr = document.getElementById("startDate").value;
      var weeks = parseInt(document.getElementById("duration").value);
      var discountRate = parseFloat(document.getElementById("discount").value);
      
      if (!startDateStr) {
        showToast("수강 시작일을 선택해주세요.");
        return;
      }
      
      var startDate = new Date(startDateStr);
      var sDay = startDate.getDay();
      var firstFriday = new Date(startDate);
      if (sDay <= 5) {
        firstFriday.setDate(startDate.getDate() + (5 - sDay));
      } else {
        firstFriday.setDate(startDate.getDate() + (12 - sDay));
      }
      var endDate = new Date(firstFriday);
      endDate.setDate(firstFriday.getDate() + (weeks - 1) * 7);
      if (course === "여름방학 AP Micro Econ") {
        endDate.setDate(endDate.getDate() + 1);
      }
      
      var courseInfo = courseData[course];
      if (!courseInfo) {
        showToast("선택한 과목에 대한 정보가 없습니다.");
        return;
      }
      
      var totalFee = 0;
      if (courseInfo.category === "AP") {
        if (weeks > 3) {
          alert("AP 과정은 최대 3주까지만 수강 가능합니다.");
          return;
        }
        totalFee = (weeks === 3) ? courseInfo.threeWeekRate : Math.round(courseInfo.threeWeekRate / 3 * weeks);
      } else {
        totalFee = courseInfo.weeklyRate * weeks;
      }
      
      var finalFee = Math.round(totalFee * (1 - discountRate));
      
      var selectedAPTime = "";
      if (courseData[course].category === "AP") {
        var apTimeRadio = document.querySelector('input[name="apTimeOption"]:checked');
        if (apTimeRadio) {
          selectedAPTime = apTimeRadio.value;
        }
      }
      
      document.getElementById("infoName").textContent = name;
      document.getElementById("infoCourse").textContent = course;
      document.getElementById("infoPeriod").textContent =
        formatDateWithDay(startDate) + " ~ " + formatDateWithDay(endDate) + " (" + weeks + "주)";
      document.getElementById("infoTime").textContent = (selectedAPTime !== "") ? selectedAPTime : courseInfo.time;
      document.getElementById("infoFee").textContent = finalFee.toLocaleString() + "원 (" + (discountRate * 100) + "% 할인)";
    }
    
    function copyReservationInfo() {
      var name = document.getElementById("infoName").innerText;
      var course = document.getElementById("infoCourse").innerText;
      var period = document.getElementById("infoPeriod").innerText;
      var time = document.getElementById("infoTime").innerText;
      var fee = document.getElementById("infoFee").innerText;
      
      // 교재비 계산: W올인원은 수강기간(주) 매핑, TOEFL은 온라인/오프라인 구분
      var textbookFee = "";
      if (course.indexOf("W올인원") !== -1) {
        var duration = parseInt(document.getElementById("duration").value);
        var feeMapping = {1:"40,000원", 2:"50,000원", 3:"60,000원", 4:"70,000원", 5:"80,000원", 6:"90,000원"};
        textbookFee = feeMapping[duration] || "";
      } else if (course.indexOf("TOEFL") !== -1) {
        if (course.indexOf("온라인") !== -1) {
          textbookFee = "30,000원";
        } else {
          textbookFee = "60,000원";
        }
      }
      
      var infoText = "감사합니다. 수강 예약 안내드립니다.\n\n" +
                     "▶학생이름: " + name + "\n" +
                     "▶수강과목: " + course + "\n" +
                     "▶수강기간: " + period + "\n" +
                     "▶수업시간: " + time + "\n" +
                     "▶수강료: " + fee + "\n";
      if (textbookFee !== "") {
        infoText += "▶교재비: " + textbookFee + "\n\n";
      } else {
        infoText += "\n";
      }
      
      infoText += "※ 계좌이체는 학생이름으로 입금 부탁드리며, 현금영수증 필요 시 발급받으실 휴대폰/사업자 번호를 알려주시기 바랍니다.\n\n" +
                  "[수강료 입금 계좌]\n신한은행 140-009-205058\n(예금주: 세한아카데미외국어학원)\n\n";
      
      if (textbookFee !== "") {
        infoText += "[교재비 입금 계좌]\n신한은행 110-378-431090\n(예금주: 김철영 세한어학연구소)";
      }
      
      navigator.clipboard.writeText(infoText).then(function() {
        showToast("예약 안내가 복사되었습니다.");
      }, function(err) {
        showToast("복사에 실패했습니다: " + err);
      });
    }
  </script>
</head>
<body>
  <h2>수강료 계산기</h2>
  <form id="tuitionForm">
    <div class="form-group">
      <label for="studentName">학생이름:</label>
      <input type="text" id="studentName" name="studentName" value="학생이름 기입" required>
    </div>
    <div class="form-group">
      <label for="course">수강과목:</label>
      <select id="course" name="course">
        <option value=""></option>
        <optgroup label="Drill Math">
          <option value="여름방학 Algebra 1 오프라인">여름방학 Algebra 1 오프라인</option>
          <option value="여름방학 Algebra 1 온라인">여름방학 Algebra 1 온라인</option>
          <option value="여름방학 Algebra 2 오프라인">여름방학 Algebra 2 오프라인</option>
          <option value="여름방학 Algebra 2 온라인">여름방학 Algebra 2 온라인</option>
        </optgroup>
        <optgroup label="DRW">
          <!-- 추가된 DRW 오전 코스 -->
          <option value="여름방학 DRW 오전 L1">여름방학 DRW 오전 L1</option>
          <option value="여름방학 DRW 오전 L2">여름방학 DRW 오전 L2</option>
          <option value="여름방학 DRW L1A">여름방학 DRW L1A</option>
          <option value="여름방학 DRW L1B">여름방학 DRW L1B</option>
          <option value="여름방학 DRW L2A">여름방학 DRW L2A</option>
          <option value="여름방학 DRW L2B">여름방학 DRW L2B</option>
          <option value="여름방학 DRW L3">여름방학 DRW L3</option>
        </optgroup>
        <optgroup label="W올인원">
          <option value="여름방학 W올인원">여름방학 W올인원</option>
        </optgroup>
        <optgroup label="TOEFL">
          <option value="여름방학 TOEFL L1 오프라인">여름방학 TOEFL L1 오프라인</option>
          <option value="여름방학 TOEFL L1 오전 온라인">여름방학 TOEFL L1 오전 온라인</option>
          <option value="여름방학 TOEFL L1 오후 온라인">여름방학 TOEFL L1 오후 온라인</option>
          <option value="여름방학 TOEFL L2 오프라인">여름방학 TOEFL L2 오프라인</option>
          <option value="여름방학 TOEFL L2 오전 온라인">여름방학 TOEFL L2 오전 온라인</option>
          <option value="여름방학 TOEFL L2 오후 온라인">여름방학 TOEFL L2 오후 온라인</option>
        </optgroup>
        <optgroup label="SAT">
          <option value="여름방학 SAT 브릿지 오프라인">여름방학 SAT 브릿지 오프라인</option>
          <option value="여름방학 SAT 브릿지 온라인">여름방학 SAT 브릿지 온라인</option>
          <option value="여름방학 SAT 1400+ 오프라인">여름방학 SAT 1400+ 오프라인</option>
          <option value="여름방학 SAT 1400+ 온라인">여름방학 SAT 1400+ 온라인</option>
          <option value="여름방학 SAT 1500+ 오프라인">여름방학 SAT 1500+ 오프라인</option>
          <option value="여름방학 SAT 1500+ 온라인">여름방학 SAT 1500+ 온라인</option>
        </optgroup>
        <optgroup label="SAT 미주/유럽">
          <option value="여름방학 SAT 미주반">여름방학 SAT 미주반</option>
          <option value="여름방학 SAT 유럽반">여름방학 SAT 유럽반</option>
        </optgroup>
        <optgroup label="AP">
          <option value="여름방학 AP Phy1">여름방학 AP Phy1</option>
          <option value="여름방학 AP Cal BC">여름방학 AP Cal BC</option>
          <option value="여름방학 AP Cal AB">여름방학 AP Cal AB</option>
          <option value="여름방학 AP Pre-cal">여름방학 AP Pre-cal</option>
          <option value="여름방학 AP World History">여름방학 AP World History</option>
          <option value="여름방학 AP Biology">여름방학 AP Biology</option>
          <option value="여름방학 AP Phy C-M">여름방학 AP Phy C-M</option>
          <option value="여름방학 AP Macro Econ">여름방학 AP Macro Econ</option>
          <option value="여름방학 AP Micro Econ">여름방학 AP Micro Econ</option>
          <option value="여름방학 AP Psychology">여름방학 AP Psychology</option>
          <option value="여름방학 AP Statistics">여름방학 AP Statistics</option>
          <option value="여름방학 AP Chemistry">여름방학 AP Chemistry</option>
          <option value="여름방학 AP Computer.A">여름방학 AP Computer.A</option>
        </optgroup>
      </select>
    </div>
    <!-- AP 시간 선택 컨테이너 추가 -->
    <div id="apTimeContainer"></div>
    <div class="form-group">
      <label for="startDate">수강시작일:</label>
      <input type="text" id="startDate" name="startDate" required>
    </div>
    <div class="form-group">
      <label for="duration">수강기간:</label>
      <select id="duration" name="duration">
        <option value="1">1주</option>
        <option value="2">2주</option>
        <option value="3">3주</option>
        <option value="4">4주</option>
        <option value="5">5주</option>
        <option value="6">6주</option>
      </select>
    </div>
    <div class="form-group">
      <label for="discount">할인율:</label>
      <select id="discount" name="discount">
        <option value="0.05">5%</option>
        <option value="0.1">10%</option>
        <option value="0.15">15%</option>
        <option value="0.2">20%</option>
      </select>
    </div>
    <button type="button" onclick="calculateTuition()">계산하기</button>
  </form>
  
  <div id="reservationInfo">
    <p>▶ 학생이름: <span id="infoName"></span></p>
    <p>▶ 수강과목: <span id="infoCourse"></span></p>
    <p>▶ 수강기간: <span id="infoPeriod"></span></p>
    <p>▶ 수업시간: <span id="infoTime"></span></p>
    <p>▶ 수강료: <span id="infoFee"></span></p>
  </div>
  
  <button id="copyButton" onclick="copyReservationInfo()">복사</button>
  <div id="toast"></div>
  
  <script>
    function showToast(message) {
      var toast = document.getElementById("toast");
      toast.textContent = message;
      toast.style.visibility = "visible";
      toast.style.opacity = "1";
      setTimeout(function() {
        toast.style.opacity = "0";
        setTimeout(function() { toast.style.visibility = "hidden"; }, 500);
      }, 2500);
    }
    
    (function(factory) {
      if (typeof define === "function" && define.amd) {
        define(["jquery", "jquery-ui"], factory);
      } else {
        factory(jQuery);
      }
    }(function($) {
      $.datepicker.regional['ko'] = {
        closeText: '닫기',
        prevText: '이전',
        nextText: '다음',
        currentText: '오늘',
        monthNames: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
        monthNamesShort: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
        dayNames: ['일요일','월요일','화요일','수요일','목요일','금요일','토요일'],
        dayNamesShort: ['일','월','화','수','목','금','토'],
        dayNamesMin: ['일','월','화','수','목','금','토'],
        weekHeader: '주',
        dateFormat: 'yy-mm-dd',
        firstDay: 0,
        isRTL: false,
        showMonthAfterYear: true,
        yearSuffix: '년'
      };
      $.datepicker.setDefaults($.datepicker.regional['ko']);
    }));
    
    var apTimeOptions = {
      group1: {
        courses: ["여름방학 AP Phy1", "여름방학 AP Cal BC", "여름방학 AP Cal AB", "여름방학 AP Pre-cal", "여름방학 AP World History", "여름방학 AP Biology"],
        options: [
          { label: "오전 (09:00~11:00)", time: "09:00~11:00" },
          { label: "오후 (18:20~20:20)", time: "18:20~20:20" }
        ]
      },
      group2: {
        courses: ["여름방학 AP Phy C-M", "여름방학 AP Macro Econ", "여름방학 AP Micro Econ", "여름방학 AP Psychology", "여름방학 AP Statistics", "여름방학 AP Chemistry", "여름방학 AP Computer.A"],
        options: [
          { label: "오전 (11:10~13:10)", time: "11:10~13:10" },
          { label: "오후 (20:30~22:30)", time: "20:30~22:30" }
        ]
      }
    };
    
    var courseData = {
      "여름방학 Algebra 1 오프라인": { category: "Drill Math", weeklyRate: 250000, time: "14:00~16:00" },
      "여름방학 Algebra 1 온라인": { category: "Drill Math", weeklyRate: 250000, time: "16:10~18:10(한국시간)" },
      "여름방학 Algebra 2 오프라인": { category: "Drill Math", weeklyRate: 250000, time: "14:00~16:00" },
      "여름방학 Algebra 2 온라인": { category: "Drill Math", weeklyRate: 250000, time: "16:10~18:10(한국시간)" },
      "여름방학 DRW 오전 L1": { category: "DRW", weeklyRate: 330000, time: "10:00~13:00(한국시간)" },
      "여름방학 DRW 오전 L2": { category: "DRW", weeklyRate: 330000, time: "10:00~13:00(한국시간)" },
      "여름방학 DRW L1A": { category: "DRW", weeklyRate: 330000, time: "19:00~22:00(한국시간)" },
      "여름방학 DRW L1B": { category: "DRW", weeklyRate: 330000, time: "20:00~23:00(한국시간)" },
      "여름방학 DRW L2A": { category: "DRW", weeklyRate: 330000, time: "19:00~22:00(한국시간)" },
      "여름방학 DRW L2B": { category: "DRW", weeklyRate: 330000, time: "20:00~23:00(한국시간)" },
      "여름방학 DRW L3":  { category: "DRW", weeklyRate: 330000, time: "20:00~23:00(한국시간)" },
      "여름방학 W올인원": { category: "W올인원", weeklyRate: 440000, time: "09:00~13:00" },
      "여름방학 TOEFL L1 오프라인": { category: "TOEFL", weeklyRate: 520000, time: "09:00~13:00" },
      "여름방학 TOEFL L1 오전 온라인": { category: "TOEFL", weeklyRate: 520000, time: "09:00~13:00(한국시간)" },
      "여름방학 TOEFL L1 오후 온라인": { category: "TOEFL", weeklyRate: 520000, time: "13:30~17:30(한국시간)" },
      "여름방학 TOEFL L2 오프라인": { category: "TOEFL", weeklyRate: 520000, time: "09:00~13:00" },
      "여름방학 TOEFL L2 오전 온라인": { category: "TOEFL", weeklyRate: 520000, time: "09:00~13:00(한국시간)" },
      "여름방학 TOEFL L2 오후 온라인": { category: "TOEFL", weeklyRate: 520000, time: "13:30~17:30(한국시간)" },
      "여름방학 SAT 브릿지 오프라인": { category: "SAT", weeklyRate: 950000, time: "09:00~17:00" },
      "여름방학 SAT 브릿지 온라인": { category: "SAT", weeklyRate: 950000, time: "13:00~21:00(한국시간)" },
      "여름방학 SAT 1400+ 오프라인": { category: "SAT", weeklyRate: 950000, time: "09:00~17:00" },
      "여름방학 SAT 1400+ 온라인": { category: "SAT", weeklyRate: 950000, time: "13:00~21:00(한국시간)" },
      "여름방학 SAT 1500+ 오프라인": { category: "SAT", weeklyRate: 950000, time: "09:00~17:00" },
      "여름방학 SAT 1500+ 온라인": { category: "SAT", weeklyRate: 950000, time: "13:00~21:00(한국시간)" },
      "여름방학 SAT 미주반": { category: "SAT미주/유럽", weeklyRate: 560000, time: "10:00~14:00(한국시간)" },
      "여름방학 SAT 유럽반": { category: "SAT미주/유럽", weeklyRate: 560000, time: "17:00~21:00(한국시간)" },
      "여름방학 AP Phy1":         { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Cal BC":        { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Cal AB":        { category: "AP", threeWeekRate: 1380000, time: "시간 미정" },
      "여름방학 AP Pre-cal":       { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP World History": { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Biology":       { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Phy C-M":       { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Macro Econ":    { category: "AP", threeWeekRate: 1035000, time: "시간 미정" },
      "여름방학 AP Micro Econ":    { category: "AP", threeWeekRate: 1035000, time: "시간 미정" },
      "여름방학 AP Psychology":    { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Statistics":    { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Chemistry":     { category: "AP", threeWeekRate: 1725000, time: "시간 미정" },
      "여름방학 AP Computer.A":    { category: "AP", threeWeekRate: 1725000, time: "시간 미정" }
    };
    
    function isDateAllowed(date) {
      if (date.getFullYear() === 2025 && date.getMonth() === 5 &&
          date.getDate() >= 1 && date.getDate() <= 15) {
        return false;
      }
      var course = $("#course").val();
      var courseInfo = courseData[course];
      var courseCategory = courseInfo ? courseInfo.category : "";
      if (courseCategory === "AP") {
        if (date.getFullYear() === 2025 && date.getMonth() === 6 &&
            (date.getDate() === 7 || date.getDate() === 8)) {
          return false;
        }
      }
      if ((courseCategory === "DRW" || courseCategory === "Drill Math" ||
           courseCategory === "W올인원") &&
          date.getFullYear() === 2025 && date.getMonth() === 5 &&
          date.getDate() === 16) {
        return false;
      }
      var allowedDay = (course === "여름방학 AP Micro Econ") ? 2 : 1;
      return date.getDay() === allowedDay;
    }
    
    $(function() {
      $("#course").select2({
        placeholder: "수강과목을 선택하세요",
        allowClear: true
      });
      
      $("#startDate").datepicker({
        dateFormat: "yy-mm-dd",
        minDate: new Date(2025, 5, 16),
        maxDate: new Date(2025, 7, 31),
        beforeShowDay: function(date) {
          if (date.getFullYear() === 2025 && date.getMonth() === 5 &&
              date.getDate() >= 1 && date.getDate() <= 15) {
            return [false, "", "Unavailable"];
          }
          var allowed = isDateAllowed(date);
          return [allowed, "", allowed ? "Available" : "Not allowed"];
        }
      });
      
      $("#course").on("change", function() {
        var selectedDateStr = $("#startDate").val();
        if (selectedDateStr) {
          try {
            var selectedDate = $.datepicker.parseDate("yy-mm-dd", selectedDateStr);
            if (!isDateAllowed(selectedDate)) {
              $("#startDate").val("");
            }
          } catch(e) {
            $("#startDate").val("");
          }
        }
        $("#startDate").datepicker("refresh");
        updateAPTimeOptions();
      });
      
      $(document).keydown(function(e) {
        if(e.altKey && e.which === 81) {
          e.preventDefault();
          calculateTuition();
        } else if(e.altKey && e.which === 82) {
          e.preventDefault();
          copyReservationInfo();
        }
      });
    });
    
    function formatDateWithDay(date) {
      var month = date.getMonth() + 1;
      var day = date.getDate();
      var days = ["일", "월", "화", "수", "목", "금", "토"];
      return month + ". " + day + "(" + days[date.getDay()] + ")";
    }
    
    function updateAPTimeOptions() {
      var course = $("#course").val();
      var container = $("#apTimeContainer");
      container.empty();
      if (!courseData[course] || courseData[course].category !== "AP") {
        container.hide();
        return;
      }
      var group = null;
      if (apTimeOptions.group1.courses.indexOf(course) !== -1) {
        group = apTimeOptions.group1;
      } else if (apTimeOptions.group2.courses.indexOf(course) !== -1) {
        group = apTimeOptions.group2;
      }
      if (group) {
        container.show();
        container.append("<p>AP 시간 선택:</p>");
        for (var i = 0; i < group.options.length; i++) {
          var opt = group.options[i];
          var radioId = "apTimeOption" + i;
          var radio = '<label for="' + radioId + '" style="margin-right:15px;"><input type="radio" name="apTimeOption" id="' + radioId + '" value="' + opt.time + '"';
          if (i === 0) radio += ' checked';
          radio += '> ' + opt.label + '</label>';
          container.append(radio);
        }
      } else {
        container.hide();
      }
    }
    
    function calculateTuition() {
      var name = document.getElementById("studentName").value;
      var course = document.getElementById("course").value;
      var startDateStr = document.getElementById("startDate").value;
      var weeks = parseInt(document.getElementById("duration").value);
      var discountRate = parseFloat(document.getElementById("discount").value);
      
      if (!startDateStr) {
        showToast("수강 시작일을 선택해주세요.");
        return;
      }
      
      var startDate = new Date(startDateStr);
      var sDay = startDate.getDay();
      var firstFriday = new Date(startDate);
      if (sDay <= 5) {
        firstFriday.setDate(startDate.getDate() + (5 - sDay));
      } else {
        firstFriday.setDate(startDate.getDate() + (12 - sDay));
      }
      var endDate = new Date(firstFriday);
      endDate.setDate(firstFriday.getDate() + (weeks - 1) * 7);
      if (course === "여름방학 AP Micro Econ") {
        endDate.setDate(endDate.getDate() + 1);
      }
      
      var courseInfo = courseData[course];
      if (!courseInfo) {
        showToast("선택한 과목에 대한 정보가 없습니다.");
        return;
      }
      
      var totalFee = 0;
      if (courseInfo.category === "AP") {
        if (weeks > 3) {
          alert("AP 과정은 최대 3주까지만 수강 가능합니다.");
          return;
        }
        totalFee = (weeks === 3) ? courseInfo.threeWeekRate : Math.round(courseInfo.threeWeekRate / 3 * weeks);
      } else {
        totalFee = courseInfo.weeklyRate * weeks;
      }
      
      var finalFee = Math.round(totalFee * (1 - discountRate));
      
      var selectedAPTime = "";
      if (courseData[course].category === "AP") {
        var apTimeRadio = document.querySelector('input[name="apTimeOption"]:checked');
        if (apTimeRadio) {
          selectedAPTime = apTimeRadio.value;
        }
      }
      
      document.getElementById("infoName").textContent = name;
      document.getElementById("infoCourse").textContent = course;
      document.getElementById("infoPeriod").textContent =
        formatDateWithDay(startDate) + " ~ " + formatDateWithDay(endDate) + " (" + weeks + "주)";
      document.getElementById("infoTime").textContent = (selectedAPTime !== "") ? selectedAPTime : courseInfo.time;
      document.getElementById("infoFee").textContent = finalFee.toLocaleString() + "원 (" + (discountRate * 100) + "% 할인)";
    }
    
    function copyReservationInfo() {
      var name = document.getElementById("infoName").innerText;
      var course = document.getElementById("infoCourse").innerText;
      var period = document.getElementById("infoPeriod").innerText;
      var time = document.getElementById("infoTime").innerText;
      var fee = document.getElementById("infoFee").innerText;
      
      // 교재비 계산: W올인원은 수강기간(주) 매핑, TOEFL은 온라인/오프라인 구분
      var textbookFee = "";
      if (course.indexOf("W올인원") !== -1) {
        var duration = parseInt(document.getElementById("duration").value);
        var feeMapping = {1:"40,000원", 2:"50,000원", 3:"60,000원", 4:"70,000원", 5:"80,000원", 6:"90,000원"};
        textbookFee = feeMapping[duration] || "";
      } else if (course.indexOf("TOEFL") !== -1) {
        if (course.indexOf("온라인") !== -1) {
          textbookFee = "30,000원";
        } else {
          textbookFee = "60,000원";
        }
      }
      
      var infoText = "감사합니다. 수강 예약 안내드립니다.\n\n" +
                     "▶학생이름: " + name + "\n" +
                     "▶수강과목: " + course + "\n" +
                     "▶수강기간: " + period + "\n" +
                     "▶수업시간: " + time + "\n" +
                     "▶수강료: " + fee + "\n";
      if (textbookFee !== "") {
        infoText += "▶교재비: " + textbookFee + "\n\n";
      } else {
        infoText += "\n";
      }
      
      infoText += "※ 계좌이체는 학생이름으로 입금 부탁드리며, 현금영수증 필요 시 발급받으실 휴대폰/사업자 번호를 알려주시기 바랍니다.\n\n" +
                  "[수강료 입금 계좌]\n신한은행 140-009-205058\n(예금주: 세한아카데미외국어학원)\n\n";
      
      if (textbookFee !== "") {
        infoText += "[교재비 입금 계좌]\n신한은행 110-378-431090\n(예금주: 김철영 세한어학연구소)";
      }
      
      navigator.clipboard.writeText(infoText).then(function() {
        showToast("예약 안내가 복사되었습니다.");
      }, function(err) {
        showToast("복사에 실패했습니다: " + err);
      });
    }
  </script>
</body>
</html>
